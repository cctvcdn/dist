(window.webpackJsonp=window.webpackJsonp||[]).push([[72],{1718:function(t,n,s){t.exports={}},1737:function(t,n,s){"use strict";s.r(n);var e=s(7),r=(s(36),s(1530),s(63),s(845),s(72),s(57),{name:"LiveStreamErrorHandler",data:function(){return{errorToasts:[],toastCounter:0,retryTimeout:null}},computed:{isOffline:function(){return this.$store.getters["offline/isOffline"]},showConnectionStatus:function(){return"connected"!==this.connectionStatus},connectionStatus:function(){return this.isOffline?"offline":this.$store.state.offline.connectionAttempts>0?"reconnecting":"connected"},statusClass:function(){return{"status-connected":"connected"===this.connectionStatus,"status-reconnecting":"reconnecting"===this.connectionStatus,"status-offline":"offline"===this.connectionStatus}},statusIcon:function(){var t={connected:"fas fa-wifi",reconnecting:"fas fa-sync-alt fa-spin",offline:"fas fa-wifi-slash"};return t[this.connectionStatus]||t.offline},statusMessage:function(){var t={connected:"Đã kết nối",reconnecting:"Đang kết nối lại...",offline:"Mất kết nối"};return t[this.connectionStatus]||t.offline}},mounted:function(){this.$nuxt.$on("api-error",this.handleApiError),this.$nuxt.$on("router-error",this.handleRouterError),this.$route.path.includes("/live/")&&this.$store.dispatch("offline/startHealthCheck")},beforeDestroy:function(){this.$nuxt.$off("api-error",this.handleApiError),this.$nuxt.$off("router-error",this.handleRouterError),this.$store.dispatch("offline/stopHealthCheck"),this.retryTimeout&&clearTimeout(this.retryTimeout)},methods:{handleApiError:function(t){var n;switch(null===(n=t.response)||void 0===n?void 0:n.status){case 502:this.showErrorToast("Máy chủ đang bận, đang cố gắng kết nối lại...","warning");break;case 503:this.showErrorToast("Dịch vụ đang bảo trì, vui lòng thử lại sau","error");break;case 504:this.showErrorToast("Kết nối chậm, đang tối ưu...","info");break;default:this.showErrorToast("Có lỗi xảy ra, vui lòng thử lại","error")}},showErrorToast:function(t){var n=this,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info",e={id:++this.toastCounter,message:t,type:s,icon:this.getToastIcon(s),timestamp:Date.now()};this.errorToasts.push(e),setTimeout((function(){n.removeToast(e.id)}),5e3)},getToastIcon:function(t){var n={info:"fas fa-info-circle",warning:"fas fa-exclamation-triangle",error:"fas fa-times-circle",success:"fas fa-check-circle"};return n[t]||n.info},removeToast:function(t){var n=this.errorToasts.findIndex((function(n){return n.id===t}));n>-1&&this.errorToasts.splice(n,1)},retryConnection:function(){var t=this;return Object(e.a)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t.retryTimeout&&clearTimeout(t.retryTimeout),t.showErrorToast("Đang thử kết nối lại...","info"),n.prev=1,n.next=2,t.$store.dispatch("offline/checkServerHealth");case 2:t.isOffline?t.showErrorToast("Không thể kết nối, vui lòng thử lại sau","error"):t.showErrorToast("Kết nối lại thành công!","success"),n.next=4;break;case 3:n.prev=3,n.catch(1),t.showErrorToast("Lỗi kết nối, vui lòng thử lại","error");case 4:case"end":return n.stop()}}),n,null,[[1,3]])})))()},handleRouterError:function(t){this.showErrorToast("Có lỗi chuyển trang, đang cố gắng khôi phục...","warning")}}}),i=r,o=(s(1826),s(42)),a=Object(o.a)(i,(function(){var t=this,n=t._self._c;return n("div",{staticClass:"live-stream-error-handler"},[t.showConnectionStatus?n("div",{staticClass:"connection-status"},[n("div",{staticClass:"status-indicator",class:t.statusClass},[n("i",{class:t.statusIcon}),t._v(" "),n("span",[t._v(t._s(t.statusMessage))])])]):t._e(),t._v(" "),t.isOffline?n("div",{staticClass:"offline-banner"},[n("div",{staticClass:"offline-content"},[n("i",{staticClass:"fas fa-wifi-slash"}),t._v(" "),n("span",[t._v("Đang ở chế độ offline")]),t._v(" "),n("button",{staticClass:"retry-btn",on:{click:t.retryConnection}},[t._v("\n        Thử lại\n      ")])])]):t._e(),t._v(" "),n("div",{staticClass:"error-toast-container"},[n("transition-group",{attrs:{name:"toast",tag:"div"}},t._l(t.errorToasts,(function(s){return n("div",{key:s.id,staticClass:"error-toast",class:s.type},[n("i",{class:s.icon}),t._v(" "),n("span",[t._v(t._s(s.message))]),t._v(" "),n("button",{staticClass:"close-btn",on:{click:function(n){return t.removeToast(s.id)}}},[n("i",{staticClass:"fas fa-times"})])])})),0)],1)])}),[],!1,null,"5addb138",null);n.default=a.exports},1826:function(t,n,s){"use strict";s(1718)}}]);