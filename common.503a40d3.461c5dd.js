(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{1588:function(e,t,n){"use strict";n.r(t),n(56);var r=n(1549),a=n(1557),s={name:"BlvSchedule",components:{GradientHeader:r.default,Match:a.default},props:{matches:{type:Array,default:function(){return[]}},selectedBlv:{type:Object,default:function(){}}}},o=n(42),i=Object(o.a)(s,(function(){var e,t,n=this,r=n._self._c;return r("div",[r("GradientHeader",[n._v("LỊCH BLV CỦA "+n._s((null===(e=n.selectedBlv)||void 0===e?void 0:e.name)||""))]),n._v(" "),null!==(t=n.matches)&&void 0!==t&&t.length?r("div",{staticClass:"grid grid-cols-1 md:grid-cols-2 gap-4"},n._l(n.matches,(function(e){return r("Match",{key:e._id,attrs:{match:e,league:e.league}})})),1):r("div",{staticClass:"flex justify-center items-center"},[r("a-empty",{attrs:{description:"BLV này chưa có lịch bình luận"}})],1)],1)}),[],!1,null,null,null);t.default=i.exports},1606:function(e,t,n){"use strict";!function(e){var r=n(75),a=n(60),s=n(28),o=n(7),i=(n(36),n(66),n(1530),n(43),n(47),n(63),n(199),n(108),n(107),n(843),n(845),n(56),n(50),n(27),n(61),n(62),n(44),n(93),n(72),n(98),n(145),n(449),n(39),n(57),n(1634));function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function u(e){for(var t=1;arguments.length>t;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){Object(s.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}t.a={name:"CentriChat",components:{LeaderboardModal:i.default},props:{apiBase:{type:String,default:function(){return e.env.CHAT_API_BASE||"http://localhost:5000/v1"}},centrifugoUrl:{type:String,default:"wss://chat.ccdb.live/connection/websocket"},channel:{type:String,default:"channel"}},data:function(){return{centrifuge:null,isConnected:!1,input:"",isSending:!1,userError:!1,errorType:null,errorMessage:"",messages:[],user:null,defaultAvatar:"https://i.imgur.com/B9Dd3cd.gif",bearerToken:"",isLoggedIn:!1,isMobile:!1,showWelcomeOverlay:!1,showControlModal:!1,selectedMessage:null,modalPosition:{x:0,y:0},showProfileModal:!1,selectedUser:null,chatRoomId:null,showEmojiModal:!1,filteredEmojis:[],focusedEmojiIndex:-1,showUserDropdown:!1,showSenderIdDropdown:!1,copyIPFeedback:"",actionFeedback:"",showLeaderboardModal:!1,leaderboardType:"user",isRefreshingToken:!1,isUserScrolling:!1,isNearBottom:!0,scrollThreshold:100,newMessagesCount:0,scrollTimeout:null,emojis:[{emoji:"😀",alt:"😀",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/ta5/2/30/1f600.png"},{emoji:"😃",alt:"😃",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/t28/2/30/1f603.png"},{emoji:"😄",alt:"😄",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/ta9/2/30/1f604.png"},{emoji:"😁",alt:"😁",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/t26/2/30/1f601.png"},{emoji:"😆",alt:"😆",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/tab/2/30/1f606.png"},{emoji:"🥹",alt:"🥹",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/t4a/2/30/1f979.png"},{emoji:"😅",alt:"😅",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/t2a/2/30/1f605.png"},{emoji:"😂",alt:"😂",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/ta7/2/30/1f602.png"},{emoji:"🤣",alt:"🤣",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/t29/2/30/1f923.png"},{emoji:"🥲",alt:"🥲",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/tc3/2/30/1f972.png"},{emoji:"☺️",alt:"☺️",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/t44/2/30/263a.png"},{emoji:"😊",alt:"😊",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/t56/2/30/1f60a.png"},{emoji:"😇",alt:"😇",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/t2c/2/30/1f607.png"},{emoji:"🙂",alt:"🙂",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/t23/2/30/1f642.png"},{emoji:"🙃",alt:"🙃",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/ta4/2/30/1f643.png"},{emoji:"😉",alt:"😉",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/t2e/2/30/1f609.png"},{emoji:"😌",alt:"😌",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/t58/2/30/1f60c.png"},{emoji:"😍",alt:"😍",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/td9/2/30/1f60d.png"},{emoji:"🥰",alt:"🥰",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/tc1/2/30/1f970.png"},{emoji:"😘",alt:"😘",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/t4c/2/30/1f618.png"},{emoji:"😗",alt:"😗",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/tcb/2/30/1f617.png"},{emoji:"😙",alt:"😙",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/tcd/2/30/1f619.png"},{emoji:"😚",alt:"😚",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/tf5/2/30/1f61a.png"},{emoji:"😋",alt:"😋",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/td7/2/30/1f60b.png"},{emoji:"😛",alt:"😛",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/t76/2/30/1f61b.png"},{emoji:"😝",alt:"😝",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/t78/2/30/1f61d.png"},{emoji:"😜",alt:"😜",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/tf7/2/30/1f61c.png"},{emoji:"🤪",alt:"🤪",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/t57/2/30/1f92a.png"},{emoji:"🤨",alt:"🤨",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/tae/2/30/1f928.png"},{emoji:"🧐",alt:"🧐",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/tb4/2/30/1f9d0.png"},{emoji:"🤓",alt:"🤓",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/t8a/2/30/1f913.png"},{emoji:"😎",alt:"😎",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/t5a/2/30/1f60e.png"},{emoji:"🥸",alt:"🥸",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/tc9/2/30/1f978.png"},{emoji:"🤩",alt:"🤩",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/t2f/2/30/1f929.png"},{emoji:"🥳",alt:"🥳",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/t44/2/30/1f973.png"},{emoji:"😏",alt:"😏",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/tdb/2/30/1f60f.png"},{emoji:"😒",alt:"😒",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/t46/2/30/1f612.png"},{emoji:"😞",alt:"😞",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/tf9/2/30/1f61e.png"},{emoji:"😔",alt:"😔",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/t48/2/30/1f614.png"},{emoji:"😟",alt:"😟",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/t7a/2/30/1f61f.png"},{emoji:"😕",alt:"😕",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/tc9/2/30/1f615.png"},{emoji:"🙁",alt:"🙁",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/ta2/2/30/1f641.png"},{emoji:"☹️",alt:"☹️",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/t1c/2/30/2639.png"},{emoji:"😣",alt:"😣",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/t66/2/30/1f623.png"},{emoji:"😖",alt:"😖",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/t4a/2/30/1f616.png"},{emoji:"😫",alt:"😫",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/t15/2/30/1f62b.png"},{emoji:"😩",alt:"😩",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/t6c/2/30/1f629.png"},{emoji:"🥺",alt:"🥺",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/t72/2/30/1f97a.png"},{emoji:"😢",alt:"😢",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/te5/2/30/1f622.png"},{emoji:"😭",alt:"😭",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/t17/2/30/1f62d.png"},{emoji:"😤",alt:"😤",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/te7/2/30/1f624.png"},{emoji:"😠",alt:"😠",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/te3/2/30/1f620.png"},{emoji:"😡",alt:"😡",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/t64/2/30/1f621.png"},{emoji:"🤬",alt:"🤬",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/t59/2/30/1f92c.png"},{emoji:"🤯",alt:"🤯",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/tdc/2/30/1f92f.png"},{emoji:"😳",alt:"😳",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/t5/2/30/1f633.png"},{emoji:"🥵",alt:"🥵",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/t46/2/30/1f975.png"},{emoji:"🥶",alt:"🥶",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/tc7/2/30/1f976.png"},{emoji:"😶‍🌫️",alt:"😶‍🌫️",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/t4e/2/30/1f636_200d_1f32b.png"},{emoji:"😱",alt:"😱",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/t3/2/30/1f631.png"},{emoji:"😨",alt:"😨",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/teb/2/30/1f628.png"},{emoji:"😰",alt:"😰",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/t82/2/30/1f630.png"},{emoji:"😥",alt:"😥",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/t68/2/30/1f625.png"},{emoji:"😓",alt:"😓",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/tc7/2/30/1f613.png"},{emoji:"🤗",alt:"🤗",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/t8e/2/30/1f917.png"},{emoji:"🤔",alt:"🤔",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/tb/2/30/1f914.png"},{emoji:"🫣",alt:"🫣",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/tfe/2/30/1fae3.png"},{emoji:"🤭",alt:"🤭",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/tda/2/30/1f92d.png"},{emoji:"🫢",alt:"🫢",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/t7d/2/30/1fae2.png"},{emoji:"🫡",alt:"🫡",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/tfc/2/30/1fae1.png"},{emoji:"🤫",alt:"🤫",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/td8/2/30/1f92b.png"},{emoji:"🫠",alt:"🫠",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/t7b/2/30/1fae0.png"},{emoji:"🤥",alt:"🤥",src:"https://static.xx.fbcdn.net/images/emoji.php/v9/t2b/2/30/1f925.png"}]}},computed:{shouldShowLoginOverlay:function(){var e;return!this.isLoggedIn&&this.isConnected&&!this.showWelcomeOverlay&&("guest"===(null===(e=this.user)||void 0===e?void 0:e.role)||!this.user)}},mounted:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var n,r,a,s,o,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:t.prev=0,e.isLoggedIn=(null===(n=e.$auth)||void 0===n?void 0:n.loggedIn)||!1,e.isMobile=(null===(r=e.$device)||void 0===r?void 0:r.isMobile)||768>window.innerWidth;try{e.$nuxt&&"function"==typeof e.$nuxt.$on&&e.$nuxt.$on("user-token-refreshed",e.refreshCentrifugoToken),"undefined"!=typeof window&&window.addEventListener("user-token-refreshed",e.refreshCentrifugoToken)}catch(c){}if(null!=(a=e.$auth)&&a.loggedIn)o=a.user||{},e.user={id:(o._id||o.id||"").toString(),username:(o.username||o.name||"user").toLowerCase().replace(/\s+/g,"_"),name:o.name||o.username||"User",avatar:o.avatar||o.avatar_url||e.defaultAvatar,role:o.role||"user",level:(null===(s=e.$store)||void 0===s||null===(s=s.state)||void 0===s||null===(s=s.user)||void 0===s||null===(s=s.stats)||void 0===s?void 0:s.currentLevel)||o.currentLevel||1};else{try{i=localStorage.getItem("guestName")}catch(u){}if(!i){i=e.generateGuestName();try{localStorage.setItem("guestName",i)}catch(h){}}e.user={id:"guest",username:i.toLowerCase().replace(/\s+/g,"_"),name:i,avatar:e.defaultAvatar,role:"guest",level:1}}return t.next=1,new Promise((function(e,t){if(window.Centrifuge)return e();var n=document.createElement("script");n.src="https://unpkg.com/centrifuge@5.4.0/dist/centrifuge.js",n.async=!0,n.onload=function(){return e()},n.onerror=t,document.head.appendChild(n)}));case 1:return t.next=2,e.initCentrifuge();case 2:document.addEventListener("keydown",e.handleEmojiKeydown),t.next=4;break;case 3:t.prev=3,t.catch(0),e.userError=!0,e.errorType="connection_failed",e.errorMessage="Không thể khởi tạo chat";case 4:case"end":return t.stop()}}),t,null,[[0,3]])})))()},beforeDestroy:function(){document.removeEventListener("keydown",this.handleEmojiKeydown);try{this.$nuxt&&"function"==typeof this.$nuxt.$off&&this.$nuxt.$off("user-token-refreshed",this.refreshCentrifugoToken),"undefined"!=typeof window&&window.removeEventListener("user-token-refreshed",this.refreshCentrifugoToken)}catch(e){}},watch:{"$auth.loggedIn":{handler:function(e){var t;if(this.isLoggedIn=e,e&&null!==(t=this.$auth)&&void 0!==t&&t.user){var n,r=this.$auth.user;this.user={id:(r._id||r.id||"").toString(),username:(r.username||r.name||"user").toLowerCase().replace(/\s+/g,"_"),name:r.name||r.username||"User",avatar:r.avatar||r.avatar_url||this.defaultAvatar,role:r.role||"user",level:(null===(n=this.$store)||void 0===n||null===(n=n.state)||void 0===n||null===(n=n.user)||void 0===n||null===(n=n.stats)||void 0===n?void 0:n.currentLevel)||r.currentLevel||1}}},immediate:!0}},methods:{formatTime:function(e){var t=Date.now(),n=Math.floor((t-e)/1e3);return 60>n?"".concat(n," giây trước"):3600>n?"".concat(Math.floor(n/60)," phút trước"):new Date(e).toLocaleTimeString("vi-VN",{hour:"2-digit",minute:"2-digit"})},getRoleClass:function(e){return e&&{admin:"Admin",administrator:"Admin",ktv:"Mod",mod:"Mod",moderator:"Mod",blv:"Blv",user:"",guest:"guest"}[e.toLowerCase()]||""},getLevelBadge:function(e){return e&&e>0?n(1>e||e>19?20>e||e>39?40>e||e>59?60>e||e>79?80>e||e>100?101>e||e>109?110>e||e>119?120>e||e>129?130>e||e>139?140>e||e>149?150>e||e>159?160>e||e>169?170>e||e>179?180>e||e>189?190>e||e>199?200>e||e>299?300>e||e>349?350>e||e>399?400>e||e>449?1550:1579:1578:1577:1576:1575:1574:1573:1572:1571:1570:1569:1568:1567:1566:1565:1564:1563:1562:1561):""},shouldShowLevelText:function(e){return e>=1&&100>=e},isTitleActive:function(e){return!(!e||!e.expiresAt)&&new Date<new Date(e.expiresAt)},getTitleBadgeImage:function(e){return{top1:n(1691),top2:n(1692),top3:n(1693),top4:n(1694),top5:n(1695),top6:n(1696),top7:n(1697),top8:n(1698),top9:n(1699),top10:n(1604)}[e]||n(1604)},generateGuestName:function(){return[["Thủ Môn","Tiền Đạo","Hậu Vệ","Trọng Tài","Cầu Thủ","HLV","Fan MU","Fan PSG","Fan Real","Thầy Park","Anh Đức","CR7","Messi","Neymar","Mbappe","Ông Bầu","Bầu Đức"],["Chạy","Sút","Xoạc","Gào","Cản","Đánh Gót","Ăn Vạ","Nằm Sân","Lật Kèo","Gánh Đội","Bắt Lỗi","Tấu Hài","Né VAR","Mất Bóng","Lỡ Trớn","Sút Lên Trời"],["VAR","Thẻ Đỏ","Bóng Bay","Khán Đài","Cột Dọc","Cúp Vàng","Bàn Thắng","Lưới","Ghế Dự Bị","Sân Cỏ","Hiệp Phụ","Bóng Ma","Đèn Sân","Giày Đinh","Khung Thành"],["Mèo","Cáo","Gà","Chó","Heo","Khỉ","Trâu","Hổ","Ngựa","Thỏ","Rùa","Vịt","Bò","Dê","Nhím"],["Ngáo Ngơ","Quý Sờ Tộc","May Mắn","Vô Đối","Cười Xỉu","Dễ Thương","Lầy Lội","Đen Đủi","Quạu Quọ","Hên Xui","Trầm Cảm","Bá Đạo","No Skill","One Shot","Chơi Khô Máu"]].sort((function(){return.5-Math.random()})).slice(0,Math.floor(2*Math.random())+2).map((function(e){return e[Math.floor(Math.random()*e.length)]})).join(" ")},ensureBearerToken:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var n,r,a,s,o,i,c,u,h,l,d,p;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(s=(null===(n=e.$auth)||void 0===n?void 0:n.getToken)&&e.$auth.getToken("local")||(null===(r=e.$auth)||void 0===r||null===(r=r.strategy)||void 0===r||null===(r=r.token)||void 0===r||null===(a=r.get)||void 0===a?void 0:a.call(r))||"")){t.next=1;break}return e.bearerToken=s.startsWith("Bearer")?s.replace(/^Bearer\s+/i,""):s,t.abrupt("return",e.bearerToken);case 1:if(t.prev=1,!(o=localStorage.getItem("guestAccessToken"))){t.next=2;break}return e.bearerToken=o,t.abrupt("return",e.bearerToken);case 2:t.next=4;break;case 3:t.prev=3,t.catch(1);case 4:if(t.prev=4,!(h=null===(i=e.user)||void 0===i?void 0:i.name)){try{h=localStorage.getItem("guestName")}catch(f){}if(!h){h=e.generateGuestName();try{localStorage.setItem("guestName",h)}catch(m){}}}return t.next=5,fetch("".concat(e.apiBase,"/guest-token"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({guestName:h})});case 5:if((l=t.sent).ok){t.next=6;break}throw Error("guest_token_failed");case 6:return t.next=7,l.json();case 7:if(d=t.sent,!(p=(null==d||null===(c=d.data)||void 0===c?void 0:c.token)||(null==d||null===(u=d.data)||void 0===u?void 0:u.guestToken)||(null==d?void 0:d.token))){t.next=8;break}e.bearerToken=p,e.user&&(e.user.name=h,e.user.username=h.toLowerCase().replace(/\s+/g,"_"));try{localStorage.setItem("guestAccessToken",p)}catch(g){}return t.abrupt("return",e.bearerToken);case 8:t.next=10;break;case 9:t.prev=9,t.catch(4);case 10:return t.abrupt("return","");case 11:case"end":return t.stop()}}),t,null,[[1,3],[4,9]])})))()},refreshTokenIfExpired:function(e){var t=this;return Object(o.a)(regeneratorRuntime.mark((function n(){var r,a,s,o,i;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(401!==e.status&&403!==e.status&&404!==e.status){n.next=9;break}if(n.prev=1,r=e.headers.get("x-token-refreshed"),a=e.headers.get("x-new-token"),"true"!==r||!a){n.next=2;break}t.bearerToken=a;try{localStorage.setItem("guestAccessToken",a)}catch(c){}return n.abrupt("return",!0);case 2:if(s=e.headers.get("x-token-invalid"),o=e.headers.get("x-token-refresh-required"),"true"!==s&&"true"!==o){n.next=4;break}return n.next=3,t.performTokenRefresh();case 3:return n.abrupt("return",n.sent);case 4:return n.next=5,e.text();case 5:if(!((i=n.sent).includes("jwt expired")||i.includes("Token validation error")||i.includes("Not Found"))){n.next=7;break}return n.next=6,t.performTokenRefresh();case 6:return n.abrupt("return",n.sent);case 7:n.next=9;break;case 8:n.prev=8,n.catch(1);case 9:return n.abrupt("return",!1);case 10:case"end":return n.stop()}}),n,null,[[1,8]])})))()},performTokenRefresh:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.bearerToken=null;try{localStorage.removeItem("guestAccessToken")}catch(n){}return t.next=1,e.ensureBearerToken();case 1:if(!t.sent){t.next=2;break}return t.abrupt("return",!0);case 2:return t.abrupt("return",!1);case 3:case"end":return t.stop()}}),t)})))()},fetchWithTokenRefresh:function(e){var t=arguments,n=this;return Object(o.a)(regeneratorRuntime.mark((function r(){var a,s,o,i,c,h,l,d;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a=t.length>1&&void 0!==t[1]?t[1]:{},s=n.buildAuthHeaders(a.headers||{}),o=u(u({},a),{},{headers:s}),r.next=1,fetch(e,o);case 1:if(401!==(i=r.sent).status&&403!==i.status){r.next=6;break}return r.next=2,n.refreshTokenIfExpired(i);case 2:if(!r.sent){r.next=6;break}if("true"!==i.headers.get("x-token-refreshed")){r.next=4;break}return c=n.buildAuthHeaders(a.headers||{}),h=u(u({},a),{},{headers:c}),r.next=3,fetch(e,h);case 3:i=r.sent,r.next=6;break;case 4:return l=n.buildAuthHeaders(a.headers||{}),d=u(u({},a),{},{headers:l}),r.next=5,fetch(e,d);case 5:i=r.sent;case 6:return r.abrupt("return",i);case 7:case"end":return r.stop()}}),r)})))()},buildAuthHeaders:function(){var e=u({},arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});return this.bearerToken&&(e.Authorization="Bearer ".concat(this.bearerToken)),e},initCentrifuge:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var n,r,a,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=1,e.ensureBearerToken();case 1:return t.next=2,e.fetchWithTokenRefresh("".concat(e.apiBase,"/centrifugo/token"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({channel:e.channel})});case 2:if((n=t.sent).ok){t.next=3;break}throw Error("token_failed");case 3:return t.next=4,n.json();case 4:r=t.sent,a=r.token,(s=r.user)&&(e.user=u(u(u({},e.user),s),{},{id:(s.id||s._id||e.user.id).toString()})),e.centrifuge=new window.Centrifuge(e.centrifugoUrl,{token:a}),e.centrifuge.on("connected",(function(){e.isConnected=!0,e.loadHistory()})).on("disconnected",(function(){e.isConnected=!1})).on("error",(function(e){})),e.centrifuge.newSubscription(e.channel).on("publication",(function(t){var n=t.data||{},r={text:n.text||n.message,user:n.user||{},timestamp:n.timestamp||Date.now(),links:n.links||[],hasLinks:n.hasLinks||!1},a=e.$el.querySelector(".chat-messages"),s=0,o=0;a&&(s=a.scrollTop,o=a.scrollHeight),e.messages.push(r),e.isNearBottom||e.newMessagesCount++,e.$nextTick((function(){var t=e.$el.querySelector(".chat-messages");if(t){var n=t.scrollHeight-o;s+a.clientHeight<o-10&&(t.scrollTop=s+n)}e.smartScrollToBottom()}))})).subscribe(),e.centrifuge.connect();case 5:case"end":return t.stop()}}),t)})))()},loadHistory:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=1,e.ensureBearerToken();case 1:return t.next=2,e.fetchWithTokenRefresh("".concat(e.apiBase,"/chat/history?channel=").concat(encodeURIComponent(e.channel),"&limit=50"));case 2:if((n=t.sent).ok){t.next=3;break}return t.abrupt("return");case 3:return t.next=4,n.json();case 4:(r=t.sent)&&Array.isArray(r.messages)&&(e.messages=r.messages,r.chatRoomId&&(e.chatRoomId=r.chatRoomId),e.$nextTick((function(){e.scrollToBottom(),e.checkScrollPosition(),e.debugScrollBehavior()}))),t.next=6;break;case 5:t.prev=5,t.catch(0);case 6:case"end":return t.stop()}}),t,null,[[0,5]])})))()},sendMessage:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var n,r,a,s,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.input.trim()&&e.isConnected){t.next=1;break}return t.abrupt("return");case 1:return n=e.input.trim(),e.input="",e.$nextTick((function(){var t=e.$refs.messageInput;t&&(t.style.height="28px")})),t.prev=2,t.next=3,e.ensureBearerToken();case 3:return r={message:n,channel:e.channel},t.next=4,e.fetchWithTokenRefresh("".concat(e.apiBase,"/chat/send"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});case 4:if((a=t.sent).ok){t.next=6;break}return s=console,t.next=5,a.text();case 5:o=t.sent,s.error.call(s,"send failed",o);case 6:t.next=8;break;case 7:t.prev=7,t.catch(2);case 8:case"end":return t.stop()}}),t,null,[[2,7]])})))()},handleEnter:function(e){e.shiftKey||(e.preventDefault(),e.stopPropagation(),this.sendMessage())},scrollToBottom:function(){var e=this.$el.querySelector(".chat-messages");e&&(e.scrollTop=e.scrollHeight,this.newMessagesCount=0,this.isNearBottom=!0,this.isUserScrolling=!1)},handleScroll:function(e){var t=this,n=e.target,r=n.scrollTop,a=n.scrollHeight-r-n.clientHeight;this.isNearBottom,this.isNearBottom=a<=this.scrollThreshold,this.isUserScrolling=!0,clearTimeout(this.scrollTimeout),this.scrollTimeout=setTimeout((function(){t.isUserScrolling=!1}),150)},smartScrollToBottom:function(){var e=this;this.isNearBottom&&this.$nextTick((function(){var t=e.$el.querySelector(".chat-messages");t&&(t.scrollTop=t.scrollHeight)}))},checkScrollPosition:function(){var e=this.$el.querySelector(".chat-messages");if(e){var t=e.scrollTop,n=e.scrollHeight-t-e.clientHeight;this.isNearBottom=n<=this.scrollThreshold}},debugScrollBehavior:function(){var e=this.$el.querySelector(".chat-messages");e&&window.getComputedStyle(e)},gotoLogin:function(){this.$emit("open-login-modal")},canControlMessage:function(e){var t,n=null===(t=this.user)||void 0===t||null===(t=t.role)||void 0===t?void 0:t.toLowerCase();return"admin"===n||"ktv"===n||"mod"===n||"moderator"===n},canBlockUser:function(e){var t,n,r,a=null===(t=this.user)||void 0===t||null===(t=t.role)||void 0===t?void 0:t.toLowerCase(),s=null==e||null===(n=e.user)||void 0===n||null===(n=n.role)||void 0===n?void 0:n.toLowerCase(),o=null==e||null===(r=e.user)||void 0===r?void 0:r.id;return!(o&&o.startsWith("GSID_")||("admin"===a?"admin"===s:"ktv"!==a&&"mod"!==a&&"moderator"!==a||"user"!==s))},canBlockSenderId:function(e){var t,n=null==e||null===(t=e.user)||void 0===t?void 0:t.id;return n&&n.startsWith("GSID_")&&this.canControlMessage(e)},canDeleteMessage:function(e){var t,n=null===(t=this.user)||void 0===t||null===(t=t.role)||void 0===t?void 0:t.toLowerCase();return("admin"===n||"ktv"===n||"mod"===n||"moderator"===n)&&this.canControlMessage(e)},showMessageControl:function(e,t){var n=this;return Object(o.a)(regeneratorRuntime.mark((function r(){var a,s,o;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.preventDefault(),t.stopPropagation(),n.selectedMessage=e,n.showControlModal=!0,a=t.target.getBoundingClientRect(),n.modalPosition={x:a.left,y:a.bottom+5},!n.user||!["admin","mod","ktv"].includes(n.user.role)){r.next=7;break}return r.prev=1,r.next=2,n.ensureBearerToken();case 2:return r.next=3,n.fetchWithTokenRefresh("".concat(n.apiBase,"/chat/message/").concat(e.id,"/details"));case 3:if(!(s=r.sent).ok){r.next=5;break}return r.next=4,s.json();case 4:(o=r.sent).success&&o.data&&(n.selectedMessage=u(u({},e),o.data));case 5:r.next=7;break;case 6:r.prev=6,r.catch(1);case 7:case"end":return r.stop()}}),r,null,[[1,6]])})))()},hideMessageControl:function(){this.showControlModal=!1,this.selectedMessage=null,this.showUserDropdown=!1,this.showSenderIdDropdown=!1,this.copyIPFeedback="",this.actionFeedback=""},toggleUserDropdown:function(){this.showUserDropdown=!this.showUserDropdown,this.showUserDropdown&&(this.showSenderIdDropdown=!1)},toggleSenderIdDropdown:function(){this.showSenderIdDropdown=!this.showSenderIdDropdown,this.showSenderIdDropdown&&(this.showUserDropdown=!1)},getActionFeedbackClass:function(){return this.actionFeedback?this.actionFeedback.includes("✓")?"action-success":this.actionFeedback.includes("✗")?"action-error":this.actionFeedback.includes("⚠️")?"action-warning":"":""},blockUserWithDuration:function(e){var t=this;return Object(o.a)(regeneratorRuntime.mark((function n(){var r,a,s,o,i;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t.selectedMessage){n.next=1;break}return n.abrupt("return");case 1:if(n.prev=1,a=null===(r=t.selectedMessage.user)||void 0===r?void 0:r.id){n.next=2;break}return t.actionFeedback="✗ Không thể xác định user ID",setTimeout((function(){t.actionFeedback=""}),3e3),n.abrupt("return");case 2:if(!a.startsWith("GSID_")){n.next=4;break}return n.next=3,t.blockSenderIdWithDuration(e);case 3:return n.abrupt("return");case 4:return s=0===e?"vĩnh viễn":t.formatDuration(e),n.next=5,t.ensureBearerToken();case 5:return n.next=6,t.fetchWithTokenRefresh("".concat(t.apiBase,"/block/user"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:a,reason:"spam_violation",duration:e})});case 6:if(!(o=n.sent).ok){n.next=7;break}t.actionFeedback="✓ Đã chặn người dùng trong ".concat(s,"!"),t.showUserDropdown=!1,setTimeout((function(){t.hideMessageControl()}),2e3),n.next=9;break;case 7:return n.next=8,o.text();case 8:i=n.sent,t.actionFeedback="✗ Lỗi: ".concat(i),setTimeout((function(){t.actionFeedback=""}),3e3);case 9:n.next=11;break;case 10:n.prev=10,n.catch(1),t.actionFeedback="✗ Có lỗi xảy ra khi chặn người dùng",setTimeout((function(){t.actionFeedback=""}),3e3);case 11:case"end":return n.stop()}}),n,null,[[1,10]])})))()},blockUser:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=1,e.blockUserWithDuration(86400);case 1:case"end":return t.stop()}}),t)})))()},blockSenderIdWithDuration:function(e){var t=this;return Object(o.a)(regeneratorRuntime.mark((function n(){var r,a,s,o,i;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(t.selectedMessage){n.next=1;break}return n.abrupt("return");case 1:if(n.prev=1,a=null===(r=t.selectedMessage.user)||void 0===r?void 0:r.id){n.next=2;break}return t.actionFeedback="✗ Không thể xác định sender ID",setTimeout((function(){t.actionFeedback=""}),3e3),n.abrupt("return");case 2:return s=0===e?"vĩnh viễn":t.formatDuration(e),n.next=3,t.ensureBearerToken();case 3:return n.next=4,t.fetchWithTokenRefresh("".concat(t.apiBase,"/block/sender-id"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({senderId:a,reason:"spam_violation",duration:e})});case 4:if(!(o=n.sent).ok){n.next=5;break}t.actionFeedback="✓ Đã chặn phiên chat trong ".concat(s,"!"),t.showSenderIdDropdown=!1,setTimeout((function(){t.hideMessageControl()}),2e3),n.next=7;break;case 5:return n.next=6,o.text();case 6:i=n.sent,t.actionFeedback="✗ Lỗi: ".concat(i),setTimeout((function(){t.actionFeedback=""}),3e3);case 7:n.next=9;break;case 8:n.prev=8,n.catch(1),t.actionFeedback="✗ Có lỗi xảy ra khi chặn phiên chat",setTimeout((function(){t.actionFeedback=""}),3e3);case 9:case"end":return n.stop()}}),n,null,[[1,8]])})))()},blockSenderId:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=1,e.blockSenderIdWithDuration(43200);case 1:case"end":return t.stop()}}),t)})))()},deleteMessage:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var n,r,a,s,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.selectedMessage){t.next=1;break}return t.abrupt("return");case 1:if(t.prev=1,n=e.selectedMessage.id||e.selectedMessage.messageId){t.next=2;break}return e.actionFeedback="✗ Không thể xác định message ID",setTimeout((function(){e.actionFeedback=""}),3e3),t.abrupt("return");case 2:return t.next=3,e.ensureBearerToken();case 3:return r=e.chatRoomId||e.channel,t.next=4,e.fetchWithTokenRefresh("".concat(e.apiBase,"/chat/delete-message"),{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({messageId:n,chatRoomId:r})});case 4:if(!(a=t.sent).ok){t.next=5;break}-1!==(s=e.messages.findIndex((function(e){return(e.id||e.messageId)===n})))&&e.messages.splice(s,1),e.actionFeedback="✓ Đã xóa tin nhắn thành công!",setTimeout((function(){e.hideMessageControl()}),2e3),t.next=7;break;case 5:return t.next=6,a.text();case 6:o=t.sent,e.actionFeedback="✗ Lỗi: ".concat(o),setTimeout((function(){e.actionFeedback=""}),3e3);case 7:t.next=9;break;case 8:t.prev=8,t.catch(1),e.actionFeedback="✗ Có lỗi xảy ra khi xóa tin nhắn",setTimeout((function(){e.actionFeedback=""}),3e3);case 9:case"end":return t.stop()}}),t,null,[[1,8]])})))()},formatDuration:function(e){if(0===e)return"vĩnh viễn";var t=Math.floor(e/60),n=Math.floor(t/60),r=Math.floor(n/24);return r>0?"".concat(r," ngày"):n>0?"".concat(n," tiếng"):t>0?"".concat(t," phút"):"".concat(e," giây")},tagUser:function(e){var t,n=this;if(e&&e.username!==(null===(t=this.user)||void 0===t?void 0:t.username)){var r=e.name||e.username||"User",a="@{".concat(r,"} ");this.input?this.input+=a:this.input=a,this.$nextTick((function(){if(n.$refs.messageInput){n.$refs.messageInput.focus();var e=n.$refs.messageInput;e.setSelectionRange(e.value.length,e.value.length)}}))}},processBoldText:function(e){return e?e.replace(/@\{([^}]+)\}/g,"<strong>@$1</strong>"):e},processMessageText:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];if(!e)return e;var n=e;return n=n.replace(/\n/g,"<br>"),t&&0!==t.length?(t.forEach((function(e){var t='<a href="'.concat(e,'" target="_blank" rel="noopener nofollow" class="chat-link">').concat(e,"</a>");n=n.replace(e,t)})),this.processBoldText(n)):this.processBoldText(n)},showUserProfile:function(e){var t=this;return Object(o.a)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e){n.next=1;break}return n.abrupt("return");case 1:return t.selectedUser=e,t.showProfileModal=!0,n.next=2,t.loadUserStats(e);case 2:case"end":return n.stop()}}),n)})))()},autoResizeTextarea:function(){var e=this;this.$nextTick((function(){var t=e.$refs.messageInput;if(t){t.style.height="auto";var n=Math.min(t.scrollHeight,120);t.style.height=n+"px";var r=t.closest(".chat-input-container");r&&(r.style.height="auto")}}))},loadUserStats:function(e){var t=this;return Object(o.a)(regeneratorRuntime.mark((function n(){var r,s;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,"object"!==Object(a.a)(e)||!e.id){n.next=1;break}r=e.id,n.next=3;break;case 1:if("string"!=typeof e){n.next=2;break}r=e,n.next=3;break;case 2:return n.abrupt("return");case 3:return n.next=4,t.$axios.get("/users/public-stats/".concat(r));case 4:(s=n.sent).data.success&&s.data.data&&(t.selectedUser=u(u(u({},t.selectedUser),s.data.data),{},{stats:s.data.data.stats})),n.next=6;break;case 5:n.prev=5,n.catch(0);case 6:case"end":return n.stop()}}),n,null,[[0,5]])})))()},hideUserProfile:function(){this.showProfileModal=!1,this.selectedUser=null},getRoleDisplayName:function(e){return{admin:"Admin",administrator:"Admin",ktv:"KTV",mod:"Moderator",moderator:"Moderator",blv:"BLV",master:"Master",seo:"SEO"}[null==e?void 0:e.toLowerCase()]||e||"User"},formatWatchTime:function(e){if(!e||0>=e)return"0h";var t=Math.floor(e/3600);return 1>t?"".concat(Math.floor(e/60),"p"):"".concat(t,"h")},toggleEmojiModal:function(){this.showEmojiModal=!this.showEmojiModal,this.showEmojiModal&&(this.filteredEmojis=Object(r.a)(this.emojis))},insertEmoji:function(e){var t=this.$refs.messageInput;if(t){var n=t.selectionStart,r=t.selectionEnd,a=this.input;this.input=a.substring(0,n)+e+a.substring(r),this.$nextTick((function(){t.selectionStart=t.selectionEnd=n+e.length,t.focus()}))}else this.input+=e},hideEmojiModal:function(){this.showEmojiModal=!1,this.filteredEmojis=[],this.focusedEmojiIndex=-1},showBLVLeaderboard:function(){this.leaderboardType="blv",this.showLeaderboardModal=!0},showUserLeaderboard:function(){this.leaderboardType="user",this.showLeaderboardModal=!0},hideLeaderboardModal:function(){this.showLeaderboardModal=!1},copyIPToClipboard:function(e){var t=this;return Object(o.a)(regeneratorRuntime.mark((function n(){var r;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=1,navigator.clipboard.writeText(e);case 1:t.copyIPFeedback="✓ Đã copy IP!",setTimeout((function(){t.copyIPFeedback=""}),2e3),n.next=3;break;case 2:n.prev=2,n.catch(0),(r=document.createElement("textarea")).value=e,document.body.appendChild(r),r.select();try{document.execCommand("copy"),t.copyIPFeedback="✓ Đã copy IP!"}catch(a){t.copyIPFeedback="✗ Copy thất bại"}document.body.removeChild(r),setTimeout((function(){t.copyIPFeedback=""}),2e3);case 3:case"end":return n.stop()}}),n,null,[[0,2]])})))()},handleEmojiKeydown:function(e){if(this.showEmojiModal)switch(e.key){case"ArrowDown":e.preventDefault(),this.focusedEmojiIndex=Math.min(this.focusedEmojiIndex+1,this.filteredEmojis.length-1);break;case"ArrowUp":e.preventDefault(),this.focusedEmojiIndex=Math.max(this.focusedEmojiIndex-1,-1);break;case"ArrowRight":e.preventDefault(),this.focusedEmojiIndex=Math.min(this.focusedEmojiIndex+6,this.filteredEmojis.length-1);break;case"ArrowLeft":e.preventDefault(),this.focusedEmojiIndex=Math.max(this.focusedEmojiIndex-6,-1);break;case"Enter":e.preventDefault(),this.focusedEmojiIndex>=0&&this.focusedEmojiIndex<this.filteredEmojis.length&&this.insertEmoji(this.filteredEmojis[this.focusedEmojiIndex].emoji);break;case"Escape":e.preventDefault(),this.hideEmojiModal()}},refreshCentrifugoToken:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.isRefreshingToken){t.next=1;break}return t.abrupt("return");case 1:return e.isRefreshingToken=!0,t.prev=2,e.centrifuge&&(e.centrifuge.disconnect(),e.centrifuge=null),e.isConnected=!1,e.userError=!1,e.errorType=null,e.errorMessage="",t.next=3,e.ensureBearerToken();case 3:return t.next=4,e.initCentrifuge();case 4:t.next=6;break;case 5:t.prev=5,t.catch(2),e.userError=!0,e.errorType="connection_failed",e.errorMessage="Không thể làm mới token. Vui lòng thử lại sau.";case 6:return t.prev=6,e.isRefreshingToken=!1,t.finish(6);case 7:case"end":return t.stop()}}),t,null,[[2,5,6,7]])})))()}}}}(n(117))},1644:function(e,t,n){"use strict";n.r(t);var r=n(1704),a=n(1605),s=(n(1811),n(42)),o=Object(s.a)(a.a,r.a,r.b,!1,null,"29608016",null);t.default=o.exports},1706:function(e,t,n){e.exports={}},1811:function(e,t,n){"use strict";n(1706)}}]);