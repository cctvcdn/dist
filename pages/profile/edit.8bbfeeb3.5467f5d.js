(window.webpackJsonp=window.webpackJsonp||[]).push([[89],{1673:function(e,t,a){e.exports={}},1779:function(e,t,a){"use strict";a(1673)},1856:function(e,t,a){"use strict";a.r(t),a(56);var r=a(28),n=a(7),i=(a(36),a(66),a(842),a(43),a(47),a(61),a(62),a(50),a(39),a(27),a(847),a(86));function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function s(e){for(var t=1;arguments.length>t;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){Object(r.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var l={name:"ProfileEditPage",layout:"default",middleware:"auth",data:function(){return{loading:!1,form:{username:"",email:"",phone:"",name:"",avatar:"",dateOfBirth:""},avatarFile:null,rules:{username:[{required:!0,message:"Vui lòng nhập tên đăng nhập",trigger:"blur"}],email:[{required:!0,message:"Vui lòng nhập email",trigger:"blur"},{type:"email",message:"Email không hợp lệ",trigger:"blur"}],phone:[{required:!0,message:"Vui lòng nhập số điện thoại",trigger:"blur"},{pattern:/^[0-9]{10}$/,message:"Số điện thoại không hợp lệ",trigger:"blur"}],name:[{required:!0,message:"Vui lòng nhập tên hiển thị",trigger:"blur"}],dateOfBirth:[{type:"string",message:"Vui lòng chọn ngày sinh hợp lệ",trigger:"change"}]}}},created:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=1,e.$auth.user;case 1:(a=t.sent)&&(e.form={username:a.username,email:a.email,phone:a.phone,name:a.name,avatar:a.avatar,dateOfBirth:a.dateOfBirth?e.formatDateForInput(a.dateOfBirth):""}),t.next=3;break;case 2:t.prev=2,t.catch(0),e.$message.error("Không thể tải thông tin người dùng");case 3:case"end":return t.stop()}}),t,null,[[0,2]])})))()},methods:s(s(s({},Object(i.b)(["uploadImage"])),Object(i.b)("authen",["updateUser"])),{},{handleAvatarClick:function(){this.$refs.avatarInput.click()},handleAvatarChange:function(e){var t=this,a=e.target.files[0];if(a){this.avatarFile=a;var r=new FileReader;r.onload=function(e){t.form.avatar=e.target.result},r.readAsDataURL(a)}},handleSubmit:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var a,r,n,i,o,l,c,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e.loading=!0,t.next=1,e.$refs.profileForm.validate();case 1:if(!t.sent){t.next=7;break}if(!e.avatarFile){t.next=3;break}return(a=new FormData).append("image",e.avatarFile),t.next=2,e.uploadImage(a);case 2:r=t.sent,e.form.avatar_url=r.imageUrl;case 3:return(n=s({},e.form)).dateOfBirth,t.next=4,e.updateUser(n);case 4:if(!t.sent){t.next=6;break}return t.next=5,e.$auth.fetchUser();case 5:e.$message.success("Cập nhật thông tin thành công!"),e.$router.push("/profile"),t.next=7;break;case 6:e.$message.error("Cập nhật thông tin thất bại!");case 7:t.next=9;break;case 8:t.prev=8,409===(null==(u=t.catch(0))||null===(i=u.response)||void 0===i?void 0:i.status)&&null!=u&&null!==(o=u.response)&&void 0!==o&&null!==(o=o.data)&&void 0!==o&&o.message?e.$nextTick((function(){var t=e.$refs.profileForm.fields.find((function(e){return"name"===e.prop}));t&&(t.validateMessage=u.response.data.message,t.validateState="error")})):(c=(null==u||null===(l=u.response)||void 0===l||null===(l=l.data)||void 0===l?void 0:l.message)||"Cập nhật thông tin thất bại!",e.$message.error({content:c,key:Date.now()+"",duration:3})),e.$message.error("Cập nhật thông tin thất bại!");case 9:return t.prev=9,e.loading=!1,t.finish(9);case 10:case"end":return t.stop()}}),t,null,[[0,8,9,10]])})))()},goBack:function(){window.history.length>1?this.$router.back():this.$router.push("/profile")},formatDateForInput:function(e){var t=new Date(e),a=t.getFullYear(),r=(t.getMonth()+1+"").padStart(2,"0"),n=(t.getDate()+"").padStart(2,"0");return"".concat(a,"-").concat(r,"-").concat(n)}}),computed:{maxDate:function(){var e=new Date,t=e.getFullYear(),a=(e.getMonth()+1+"").padStart(2,"0"),r=(e.getDate()+"").padStart(2,"0");return"".concat(t,"-").concat(a,"-").concat(r)}}},c=(a(1779),a(42)),u=Object(c.a)(l,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"min-h-screen bg-[#101820] w-full md:px-4 md:flex md:items-center md:justify-center py-8"},[t("div",{staticClass:"w-full max-w-3xl bg-[#181f2a] rounded-lg overflow-hidden shadow-lg p-6"},[t("div",{staticClass:"flex items-center gap-4 mb-6"},[t("button",{staticClass:"text-white hover:text-green-500 transition",on:{click:e.goBack}},[t("i",{staticClass:"fas fa-arrow-left text-lg"})]),e._v(" "),t("h1",{staticClass:"text-2xl font-bold text-white"},[e._v("\n        Chỉnh sửa thông tin cá nhân\n      ")])]),e._v(" "),t("a-form-model",{ref:"profileForm",attrs:{model:e.form,rules:e.rules},on:{submit:function(t){return t.preventDefault(),e.handleSubmit.apply(null,arguments)}}},[t("div",{staticClass:"flex flex-col items-center mb-6"},[t("div",{staticClass:"relative group cursor-pointer",on:{click:e.handleAvatarClick}},[t("img",{staticClass:"w-32 h-32 rounded-full object-cover border-4 border-green-500 shadow-lg transition duration-300 group-hover:opacity-70",attrs:{src:e.form.avatar,alt:"avatar"}}),e._v(" "),t("div",{staticClass:"absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition bg-black/40 rounded-full"},[t("i",{staticClass:"fas fa-camera text-3xl text-white"})]),e._v(" "),t("input",{ref:"avatarInput",staticClass:"hidden",attrs:{type:"file",accept:"image/*"},on:{change:e.handleAvatarChange}})])]),e._v(" "),t("a-form-model-item",{attrs:{label:"Tên đăng nhập",prop:"username"}},[t("a-input",{staticStyle:{"font-size":"16px"},attrs:{size:"large",placeholder:"Nhập tên đăng nhập","allow-clear":"",disabled:""},model:{value:e.form.username,callback:function(t){e.$set(e.form,"username",t)},expression:"form.username"}})],1),e._v(" "),t("a-form-model-item",{attrs:{label:"Email",prop:"email"}},[t("a-input",{staticStyle:{"font-size":"16px"},attrs:{size:"large",placeholder:"Nhập email","allow-clear":""},model:{value:e.form.email,callback:function(t){e.$set(e.form,"email",t)},expression:"form.email"}})],1),e._v(" "),t("a-form-model-item",{attrs:{label:"Số điện thoại",prop:"phone"}},[t("a-input",{staticStyle:{"font-size":"16px"},attrs:{size:"large",placeholder:"Nhập số điện thoại","allow-clear":""},model:{value:e.form.phone,callback:function(t){e.$set(e.form,"phone",t)},expression:"form.phone"}})],1),e._v(" "),t("a-form-model-item",{attrs:{label:"Ngày sinh",prop:"dateOfBirth"}},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.form.dateOfBirth,expression:"form.dateOfBirth"}],staticClass:"ant-input",staticStyle:{"font-size":"16px",width:"100%",height:"40px",padding:"8px 12px","border-radius":"8px",border:"1.5px solid #22c55e",background:"#101820",color:"#f3f4f6"},attrs:{type:"date",max:e.maxDate},domProps:{value:e.form.dateOfBirth},on:{input:function(t){t.target.composing||e.$set(e.form,"dateOfBirth",t.target.value)}}})]),e._v(" "),t("a-form-model-item",{attrs:{label:"Tên hiển thị",prop:"name"}},[t("a-input",{staticStyle:{"font-size":"16px"},attrs:{size:"large",placeholder:"Nhập tên hiển thị","allow-clear":""},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),t("a-form-model-item",[t("a-button",{staticClass:"w-full bg-green-500 hover:bg-green-600 border-none font-bold py-3 rounded-lg text-lg transition mb-4 shadow-lg",attrs:{type:"primary","html-type":"submit",size:"large",loading:e.loading}},[t("i",{staticClass:"fas fa-save mr-2"}),e._v("Lưu thay đổi\n        ")])],1)],1)],1)])}),[],!1,null,"21b3833e",null);t.default=u.exports}}]);